"use strict";(globalThis.webpackChunkbrain=globalThis.webpackChunkbrain||[]).push([[2753],{914:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"playbooks/test-driven-design/python/pytest-mock-cheatsheet","title":"pytest-mock Templates & Cheatsheet","description":"Quick Reference","source":"@site/docs/playbooks/test-driven-design/python/pytest-mock-cheatsheet.md","sourceDirName":"playbooks/test-driven-design/python","slug":"/playbooks/test-driven-design/python/pytest-mock-cheatsheet","permalink":"/playbooks/test-driven-design/python/pytest-mock-cheatsheet","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"pytest-mock Templates & Cheatsheet"},"sidebar":"playbooks","previous":{"title":"pytest Templates & Cheatsheet","permalink":"/playbooks/test-driven-design/python/pytest-cheatsheet"},"next":{"title":"Python Test Setup","permalink":"/playbooks/test-driven-design/python/setup"}}');var c=t(4848),a=t(8453);const l={title:"pytest-mock Templates & Cheatsheet"},r="pytest-mock Templates & Cheatsheet",o={},i=[{value:"Quick Reference",id:"quick-reference",level:2},{value:"Common Imports",id:"common-imports",level:3},{value:"Plug-and-Play Templates",id:"plug-and-play-templates",level:2},{value:"Basic Mock Template",id:"basic-mock-template",level:3},{value:"Mock Function Template",id:"mock-function-template",level:3},{value:"Mock Class Template",id:"mock-class-template",level:3},{value:"Mock Exception Template",id:"mock-exception-template",level:3},{value:"Mock Multiple Calls Template",id:"mock-multiple-calls-template",level:3},{value:"Spy Template (Track Real Calls)",id:"spy-template-track-real-calls",level:3},{value:"Mock Property Template",id:"mock-property-template",level:3},{value:"Mock Context Manager Template",id:"mock-context-manager-template",level:3},{value:"Mock Async Function Template",id:"mock-async-function-template",level:3},{value:"Mock with Argument Matching",id:"mock-with-argument-matching",level:3},{value:"Verify Call Arguments Template",id:"verify-call-arguments-template",level:3},{value:"Mock Multiple Functions Template",id:"mock-multiple-functions-template",level:3},{value:"Common Mock Methods",id:"common-mock-methods",level:2},{value:"Stubbing Return Values",id:"stubbing-return-values",level:3},{value:"Verification",id:"verification",level:3},{value:"Advanced Mocking",id:"advanced-mocking",level:3},{value:"Steps to Run Tests",id:"steps-to-run-tests",level:2},{value:"Command Line",id:"command-line",level:3},{value:"Running Mock Tests",id:"running-mock-tests",level:3},{value:"IDE (VS Code)",id:"ide-vs-code",level:3},{value:"IDE (PyCharm)",id:"ide-pycharm",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Mock External API",id:"mock-external-api",level:3},{value:"Mock Database",id:"mock-database",level:3},{value:"Mock File Operations",id:"mock-file-operations",level:3},{value:"Useful Links",id:"useful-links",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"pytest-mock-templates--cheatsheet",children:"pytest-mock Templates & Cheatsheet"})}),"\n",(0,c.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,c.jsx)(n.h3,{id:"common-imports",children:"Common Imports"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"import pytest\n# 'mocker' is a fixture, passed as argument, not imported\n"})}),"\n",(0,c.jsx)(n.h2,{id:"plug-and-play-templates",children:"Plug-and-Play Templates"}),"\n",(0,c.jsx)(n.h3,{id:"basic-mock-template",children:"Basic Mock Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_api_call(mocker):\n    # Arrange\n    mock_get = mocker.patch("requests.get")\n    mock_get.return_value.status_code = 200\n    mock_get.return_value.json.return_value = {"key": "value"}\n    \n    # Act\n    result = fetch_data_from_api()\n    \n    # Assert\n    assert result == {"key": "value"}\n    mock_get.assert_called_once_with("https://api.example.com/data")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-function-template",children:"Mock Function Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_calculate_total(mocker):\n    # Arrange\n    mock_discount = mocker.patch("calculator.calculate_discount")\n    mock_discount.return_value = 10.0\n    \n    # Act\n    total = calculate_total(100.0)\n    \n    # Assert\n    assert total == 90.0\n    mock_discount.assert_called_once_with(100.0)\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-class-template",children:"Mock Class Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_user_service(mocker):\n    # Arrange\n    mock_repository = mocker.patch("services.UserRepository")\n    mock_user = mock_repository.return_value\n    mock_user.find_by_id.return_value = {"id": 1, "name": "John"}\n    \n    # Act\n    user_service = UserService()\n    user = user_service.get_user(1)\n    \n    # Assert\n    assert user["name"] == "John"\n    mock_repository.assert_called_once()\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-exception-template",children:"Mock Exception Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_handles_exception(mocker):\n    # Arrange\n    mock_connection = mocker.patch("database.get_connection")\n    mock_connection.side_effect = ConnectionError("Database unavailable")\n    \n    # Act & Assert\n    with pytest.raises(ConnectionError) as exc_info:\n        connect_to_database()\n    \n    assert "Database unavailable" in str(exc_info.value)\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-multiple-calls-template",children:"Mock Multiple Calls Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_retry_mechanism(mocker):\n    # Arrange\n    mock_api = mocker.patch("api.call_external_api")\n    mock_api.side_effect = [\n        TimeoutError("First call failed"),\n        {"status": "success"}  # Second call succeeds\n    ]\n    \n    # Act\n    result = retry_api_call()\n    \n    # Assert\n    assert result["status"] == "success"\n    assert mock_api.call_count == 2\n'})}),"\n",(0,c.jsx)(n.h3,{id:"spy-template-track-real-calls",children:"Spy Template (Track Real Calls)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_spy_on_method(mocker):\n    # Arrange\n    calculator = Calculator()\n    spy_add = mocker.spy(calculator, "add")\n    \n    # Act\n    result = calculator.calculate_total(5, 3)\n    \n    # Assert\n    spy_add.assert_called_once_with(5, 3)\n    assert result == 8  # Real method was executed\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-property-template",children:"Mock Property Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_property_access(mocker):\n    # Arrange\n    mock_property = mocker.patch(\n        "models.User.email",\n        new_callable=mocker.PropertyMock\n    )\n    mock_property.return_value = "test@example.com"\n    \n    # Act\n    user = User()\n    email = user.email\n    \n    # Assert\n    assert email == "test@example.com"\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-context-manager-template",children:"Mock Context Manager Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_file_operations(mocker):\n    # Arrange\n    mock_open = mocker.patch("builtins.open", mocker.mock_open(read_data="file content"))\n    \n    # Act\n    with open("test.txt", "r") as f:\n        content = f.read()\n    \n    # Assert\n    assert content == "file content"\n    mock_open.assert_called_once_with("test.txt", "r")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-async-function-template",children:"Mock Async Function Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\nimport asyncio\n\n@pytest.mark.asyncio\nasync def test_async_function(mocker):\n    # Arrange\n    future = asyncio.Future()\n    future.set_result({"data": "result"})\n    \n    mock_async = mocker.patch("api.async_fetch_data", return_value=future)\n    \n    # Act\n    result = await fetch_data_async()\n    \n    # Assert\n    assert result == {"data": "result"}\n    mock_async.assert_called_once()\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-with-argument-matching",children:"Mock with Argument Matching"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\nfrom unittest.mock import ANY\n\ndef test_with_any_argument(mocker):\n    # Arrange\n    mock_save = mocker.patch("database.save")\n    \n    # Act\n    save_user_data({"name": "John"})\n    \n    # Assert\n    mock_save.assert_called_once_with(ANY)\n'})}),"\n",(0,c.jsx)(n.h3,{id:"verify-call-arguments-template",children:"Verify Call Arguments Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_verify_call_details(mocker):\n    # Arrange\n    mock_send = mocker.patch("email.send_email")\n    \n    # Act\n    send_notification("user@example.com", "Hello")\n    \n    # Assert\n    mock_send.assert_called_once()\n    call_args = mock_send.call_args\n    assert call_args[0][0] == "user@example.com"\n    assert "Hello" in call_args[0][1]\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-multiple-functions-template",children:"Mock Multiple Functions Template"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_multiple_mocks(mocker):\n    # Arrange\n    mock_db = mocker.patch("database.save")\n    mock_logger = mocker.patch("logger.log")\n    mock_email = mocker.patch("email.send")\n    \n    # Act\n    process_order({"id": 1, "total": 100})\n    \n    # Assert\n    mock_db.assert_called_once()\n    mock_logger.assert_called()\n    mock_email.assert_called_once()\n'})}),"\n",(0,c.jsx)(n.h2,{id:"common-mock-methods",children:"Common Mock Methods"}),"\n",(0,c.jsx)(n.h3,{id:"stubbing-return-values",children:"Stubbing Return Values"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Single return value\nmock.return_value = value\n\n# Multiple return values (sequential calls)\nmock.side_effect = [value1, value2, value3]\n\n# Exception on call\nmock.side_effect = Exception("Error message")\n\n# Call real function\nmock.side_effect = lambda *args, **kwargs: real_function(*args, **kwargs)\n'})}),"\n",(0,c.jsx)(n.h3,{id:"verification",children:"Verification"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"# Verify called\nmock.assert_called()\n\n# Verify called once\nmock.assert_called_once()\n\n# Verify called with specific args\nmock.assert_called_with(arg1, arg2)\n\n# Verify called once with args\nmock.assert_called_once_with(arg1, arg2)\n\n# Verify number of calls\nassert mock.call_count == 2\n\n# Verify not called\nmock.assert_not_called()\n\n# Get call arguments\nargs, kwargs = mock.call_args\n"})}),"\n",(0,c.jsx)(n.h3,{id:"advanced-mocking",children:"Advanced Mocking"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Mock with return value\nmock = mocker.patch("module.function", return_value=42)\n\n# Mock with side effect\nmock = mocker.patch("module.function", side_effect=Exception())\n\n# Mock with callable\nmock = mocker.patch("module.function", side_effect=lambda x: x * 2)\n\n# Mock property\nmock = mocker.patch("module.Class.property", new_callable=mocker.PropertyMock)\nmock.return_value = "value"\n'})}),"\n",(0,c.jsx)(n.h2,{id:"steps-to-run-tests",children:"Steps to Run Tests"}),"\n",(0,c.jsx)(n.h3,{id:"command-line",children:"Command Line"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# Run all tests\npytest\n\n# Run specific test file\npytest test_api.py\n\n# Run specific test function\npytest test_api.py::test_api_call\n\n# Run with verbose output\npytest -v\n\n# Show print statements\npytest -s\n\n# Run last failed tests\npytest --lf\n"})}),"\n",(0,c.jsx)(n.h3,{id:"running-mock-tests",children:"Running Mock Tests"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'# Run all mock-related tests\npytest -k "mock"\n\n# Run specific mock test\npytest test_api.py::test_api_call\n\n# Run with coverage\npytest --cov=src test_api.py\n'})}),"\n",(0,c.jsx)(n.h3,{id:"ide-vs-code",children:"IDE (VS Code)"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Click test icon in sidebar"}),"\n",(0,c.jsx)(n.li,{children:"Click play button next to test"}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"Ctrl+Shift+P"}),' \u2192 "Run Tests"']}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"ide-pycharm",children:"IDE (PyCharm)"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Right-click test file \u2192 \"Run 'pytest in test_file.py'\""}),"\n",(0,c.jsx)(n.li,{children:"Click green arrow next to test function"}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"Ctrl+Shift+F10"})," (Windows/Linux) or ",(0,c.jsx)(n.code,{children:"Cmd+Shift+R"})," (Mac)"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"mocker"})," fixture (from pytest-mock) instead of ",(0,c.jsx)(n.code,{children:"unittest.mock.patch"})]}),"\n",(0,c.jsx)(n.li,{children:"Mock at the point of use, not at definition"}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"mocker.spy()"})," to verify real method calls"]}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"mocker.patch.object()"})," for instance methods"]}),"\n",(0,c.jsx)(n.li,{children:"Verify mock calls to ensure correct behavior"}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"side_effect"})," for exceptions or multiple return values"]}),"\n",(0,c.jsx)(n.li,{children:"Clean up mocks automatically (handled by pytest-mock)"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,c.jsx)(n.h3,{id:"mock-external-api",children:"Mock External API"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'def test_external_api(mocker):\n    mock_response = mocker.Mock()\n    mock_response.json.return_value = {"data": "value"}\n    mock_response.status_code = 200\n    \n    mocker.patch("requests.get", return_value=mock_response)\n    \n    result = call_external_api()\n    assert result == {"data": "value"}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-database",children:"Mock Database"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'def test_database_query(mocker):\n    mock_db = mocker.patch("database.get_connection")\n    mock_cursor = mock_db.return_value.cursor.return_value\n    mock_cursor.fetchall.return_value = [{"id": 1, "name": "John"}]\n    \n    results = query_users()\n    assert len(results) == 1\n'})}),"\n",(0,c.jsx)(n.h3,{id:"mock-file-operations",children:"Mock File Operations"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'def test_read_file(mocker):\n    mocker.patch("builtins.open", mocker.mock_open(read_data="file content"))\n    \n    content = read_file("test.txt")\n    assert content == "file content"\n'})}),"\n",(0,c.jsx)(n.h2,{id:"useful-links",children:"Useful Links"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://pytest-mock.readthedocs.io/en/latest/",children:"pytest-mock Documentation"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://docs.python.org/3/library/unittest.mock.html",children:"unittest.mock Documentation"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var s=t(6540);const c={},a=s.createContext(c);function l(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);
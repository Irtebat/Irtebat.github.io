"use strict";(globalThis.webpackChunkbrain=globalThis.webpackChunkbrain||[]).push([[753],{914:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"playbooks/test-driven-design/python/pytest-mock-cheatsheet","title":"Pytest Mocking Cheatsheet","description":"Installation","source":"@site/docs/playbooks/test-driven-design/python/pytest-mock-cheatsheet.md","sourceDirName":"playbooks/test-driven-design/python","slug":"/playbooks/test-driven-design/python/pytest-mock-cheatsheet","permalink":"/playbooks/test-driven-design/python/pytest-mock-cheatsheet","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Pytest Mocking Cheatsheet"},"sidebar":"playbooks","previous":{"title":"pytest Cheatsheet","permalink":"/playbooks/test-driven-design/python/pytest-cheatsheet"}}');var o=t(4848),c=t(8453);const a={title:"Pytest Mocking Cheatsheet"},r="Pytest Mocking Cheatsheet",i={},l=[{value:"Installation",id:"installation",level:2},{value:"Imports",id:"imports",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Mocking Classes",id:"mocking-classes",level:2},{value:"Spy on Objects",id:"spy-on-objects",level:2},{value:"Mocking Properties",id:"mocking-properties",level:2},{value:"Mocking Builtins",id:"mocking-builtins",level:2},{value:"Async Mocking",id:"async-mocking",level:2},{value:"Useful Links",id:"useful-links",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"pytest-mocking-cheatsheet",children:"Pytest Mocking Cheatsheet"})}),"\n",(0,o.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,o.jsxs)(n.p,{children:["Requires the ",(0,o.jsx)(n.code,{children:"pytest-mock"})," plugin."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install pytest-mock\n"})}),"\n",(0,o.jsx)(n.h2,{id:"imports",children:"Imports"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import pytest\nfrom unittest.mock import MagicMock\n# 'mocker' is a fixture, so it's passed as an argument, not imported.\n"})}),"\n",(0,o.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,o.jsxs)(n.p,{children:["Unlike Java frameworks (e.g., Mockito), ",(0,o.jsx)(n.strong,{children:"no annotations"})," (like ",(0,o.jsx)(n.code,{children:"@Mock"})," or ",(0,o.jsx)(n.code,{children:"@InjectMocks"}),") are required."]}),"\n",(0,o.jsxs)(n.p,{children:["You simply inject the ",(0,o.jsx)(n.code,{children:"mocker"})," fixture into your test function."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Just add \'mocker\' as an argument\ndef test_api_call(mocker):\n    # Patch requests.get\n    mock_get = mocker.patch("requests.get")\n    \n    # Configure return value\n    mock_get.return_value.status_code = 200\n    mock_get.return_value.json.return_value = {"key": "value"}\n    \n    # Call function that uses requests.get\n    result = my_api_function()\n    \n    assert result == True\n    \n    # Verify call\n    mock_get.assert_called_once_with("https://api.example.com/data")\n'})}),"\n",(0,o.jsx)(n.h2,{id:"mocking-classes",children:"Mocking Classes"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def test_class_method(mocker):\n    # Patch the class\n    mock_class = mocker.patch("my_module.MyClass")\n    \n    # Configure instance method return value\n    mock_instance = mock_class.return_value\n    mock_instance.my_method.return_value = "mocked value"\n    \n    # Use the class\n    obj = MyClass()\n    result = obj.my_method()\n    \n    assert result == "mocked value"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"spy-on-objects",children:"Spy on Objects"}),"\n",(0,o.jsx)(n.p,{children:"Wrap an existing object to track calls without replacing it completely."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def test_spy(mocker):\n    # Spy on a method\n    spy = mocker.spy(MyClass, "my_method")\n    \n    obj = MyClass()\n    obj.my_method("arg")\n    \n    # Verify call\n    spy.assert_called_once_with("arg")\n    \n    # The original method WAS executed\n'})}),"\n",(0,o.jsx)(n.h2,{id:"mocking-properties",children:"Mocking Properties"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def test_property(mocker):\n    mock = mocker.patch("my_module.MyClass.my_property", new_callable=mocker.PropertyMock)\n    mock.return_value = 42\n    \n    obj = MyClass()\n    assert obj.my_property == 42\n'})}),"\n",(0,o.jsx)(n.h2,{id:"mocking-builtins",children:"Mocking Builtins"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def test_open(mocker):\n    mocker.patch("builtins.open", mocker.mock_open(read_data="data"))\n    \n    with open("file.txt") as f:\n        result = f.read()\n    \n    assert result == "data"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"async-mocking",children:"Async Mocking"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import pytest\nimport asyncio\n\n@pytest.mark.asyncio\nasync def test_async_function(mocker):\n    future = asyncio.Future()\n    future.set_result("mocked result")\n    \n    mocker.patch("my_module.async_function", return_value=future)\n    \n    result = await my_module.async_function()\n    assert result == "mocked result"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"useful-links",children:"Useful Links"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://pytest-mock.readthedocs.io/en/latest/",children:"pytest-mock Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.python.org/3/library/unittest.mock.html",children:"unittest.mock Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const o={},c=s.createContext(o);function a(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);
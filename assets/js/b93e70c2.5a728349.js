"use strict";(globalThis.webpackChunkbrain=globalThis.webpackChunkbrain||[]).push([[6582],{49:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"*Private/Money Control/Recommendations for client upgrade","title":"Recommendations for client upgrade","description":"Kafka client version 0.10.2.0, which is very old (released in 2016). Since then, Apache Kafka has gone through numerous major improvements, especially in client performance, resilience, protocol support, and API ergonomics.","source":"@site/docs/*Private/Money Control/Recommendations for client upgrade.md","sourceDirName":"*Private/Money Control","slug":"/*Private/Money Control/Recommendations for client upgrade","permalink":"/*Private/Money Control/Recommendations for client upgrade","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var i=r(4848),o=r(8453);const c={},l=void 0,t={},a=[{value:"Recommended Upgrade Version",id:"recommended-upgrade-version",level:3},{value:"About API changes:",id:"about-api-changes",level:3}];function d(e){const n={a:"a",br:"br",code:"code",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Kafka client version"})," ",(0,i.jsx)(n.code,{children:"**0.10.2.0**"}),", which is ",(0,i.jsx)(n.strong,{children:"very old"})," (released in ",(0,i.jsx)(n.strong,{children:"2016"}),"). Since then, Apache Kafka has gone through numerous major improvements, especially in client performance, resilience, protocol support, and API ergonomics."]}),"\n",(0,i.jsxs)(n.p,{children:["Your current Kafka client version is ",(0,i.jsx)(n.code,{children:"**0.10.2.0**"}),", which is ",(0,i.jsx)(n.strong,{children:"very old"})," (it was released in ",(0,i.jsx)(n.strong,{children:"2016"}),"). Since then, Apache Kafka has undergone major enhancements in:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Performance"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Resilience"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Protocol support (e.g., idempotent producer, cooperative rebalancing)"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"recommended-upgrade-version",children:"Recommended Upgrade Version"}),"\n",(0,i.jsxs)(n.p,{children:["Upgrade to the latest ",(0,i.jsx)(n.strong,{children:"Confluent Kafka Client"})," version:"]}),"\n",(0,i.jsx)("dependency",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)("groupId",{children:"org.apache.kafka"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)("artifactId",{children:"kafka-clients"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)("version",{children:"7.9.2-ce"})]})}),"\n",(0,i.jsx)(n.p,{children:"Gradle:"}),"\n",(0,i.jsxs)(n.p,{children:["// ",(0,i.jsx)(n.a,{href:"https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients",children:"https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients"}),(0,i.jsx)(n.br,{}),"\n","implementation group: 'org.apache.kafka', name: 'kafka-clients', version: '7.9.2-ce'"]}),"\n",(0,i.jsxs)(n.p,{children:["Source repo: ",(0,i.jsx)(n.a,{href:"https://mvnrepository.com/repos/confluent-packages",children:"https://mvnrepository.com/repos/confluent-packages"})]}),"\n",(0,i.jsx)(n.p,{children:"Note:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"kafka-clients:7.9.2-ce"})," (Confluent) = Apache Kafka Client ",(0,i.jsx)(n.code,{children:"3.7.0"})]}),"\n",(0,i.jsxs)(n.li,{children:["Compatible Spring projects:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Spring for Kafka"}),": ",(0,i.jsx)(n.code,{children:"3.3.x"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Spring Kafka Integration"}),": ",(0,i.jsx)(n.code,{children:"6.4.x"})," or later"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Kafka provides bidrectly ",(0,i.jsx)(n.strong,{children:"wire compatibility"})," between brokers and clients ",(0,i.jsx)(n.strong,{children:"since version"})," ",(0,i.jsx)(n.code,{children:"**0.10.0**"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["This means you can ",(0,i.jsx)(n.strong,{children:"upgrade clients independently"})," of the broker version, and it is a painless change request"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"about-api-changes",children:"About API changes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Kafka clients ",(0,i.jsx)(n.strong,{children:"no longer depend on Zookeeper"})," \u2014 they directly communicate with Kafka brokers for metadata and coordination."]}),"\n",(0,i.jsxs)(n.li,{children:["Deprecated methods (e.g., ",(0,i.jsx)(n.code,{children:"poll(long)"}),") are still supported but you should plan to replace with modern alternatives like ",(0,i.jsx)(n.code,{children:"poll(Duration)"})," over the long term."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Suggestions to review and update your code for performance and better stability:"}),"\n",(0,i.jsx)(n.p,{children:"Consumer Client"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Review and configure:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"max.poll.interval.ms"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"max.poll.records"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"heartbeat.interval.ms"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"session.timeout.ms"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If the consumer does not call ",(0,i.jsx)(n.code,{children:"poll()"})," within ",(0,i.jsx)(n.code,{children:"max.poll.interval.ms"}),", it will be considered dead, even if heartbeats are sent."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"poll()"})," always returns a ",(0,i.jsx)(n.strong,{children:"non-null"}),", possibly empty ",(0,i.jsx)(n.code,{children:"ConsumerRecords"})," object."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Consider using ",(0,i.jsx)(n.strong,{children:"cooperative rebalancing"})," (available since Kafka 2.4) to avoid full rebalance and improves stability during rolling deployments."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set partition.assignment.strategy = org.apache.kafka.clients.consumer.CooperativeStickyAssignor"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Producer Client"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Review and configure:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"acks"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"linger.ms"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"batch.size"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"enable.idempotence = true"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This ensures that exactly one copy of each message is written in the stream in case of a producer retry"}),"\n",(0,i.jsxs)(n.li,{children:["Automatically sets ",(0,i.jsx)(n.code,{children:"retries = Integer.MAX_VALUE"})," and restricts ",(0,i.jsx)(n.code,{children:"max.in.flight.requests.per.connection <= 5"}),"."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var s=r(6540);const i={},o=s.createContext(i);function c(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);
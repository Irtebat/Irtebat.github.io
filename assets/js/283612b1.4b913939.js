"use strict";(globalThis.webpackChunkbrain=globalThis.webpackChunkbrain||[]).push([[9564],{2348:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"*Private/JioStar/Migration/Consumer First","title":"Consumer First","description":"Migration","source":"@site/docs/*Private/JioStar/Migration/Consumer First.md","sourceDirName":"*Private/JioStar/Migration","slug":"/*Private/JioStar/Migration/Consumer First","permalink":"/*Private/JioStar/Migration/Consumer First","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var s=r(4848),i=r(8453);const o={},l=void 0,c={},a=[];function d(e){const n={br:"br",em:"em",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Migration"})}),"\n",(0,s.jsx)(n.p,{children:"Setup Cluster Linking : sync data + offsets"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Resources Shared"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Migrate consumers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Stop the consumer."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Update bootstrap endpoints and other relevant configs to point to CC."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Ensure offsets are synced (use a utility to assist)."})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Restart the consumer against CC."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Migrate producers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Stop the producer"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Promote the mirror topic"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"This step enforces that replication lag is zero before writes are permitted"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"You can confirm there is no replication lag via the Cluster Link metrics"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"io.confluent.kafka.server/cluster_link_mirror_topic_offset_lag"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Update bootstrap endpoints and other relevant configs"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Restart the producer against CC"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rollback:"}),(0,s.jsx)(n.br,{}),"\n","Let\u2019s assume we have 5 Consumer Groups: CG-1 through CG-5.Suppose CG-1, CG-2, and CG-3 have been migrated to CC, while the remaining continue on-prem. If an issue arises that necessitates rolling back these three consumer groups to the on-prem Kafka cluster, the requirement is to retain their consumer offsets as tracked in CC, and reflect those offsets accurately on-prem to avoid re-reading data.Since bidirectional cluster linking is not supported b/w OSK and CC, we cannot rely on automatic offset sync from CC to on-prem.One approach I would recommend is to perform a controlled rollback as follows: ( we can perform these programmatically ):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Fetch offsets of CG-1, CG-2, and CG-3 from CC"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Apply the fetched offsets to the on-prem cluster"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"A reusable utility tool built using Kafka SDKs can automate these steps."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var t=r(6540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkbrain=globalThis.webpackChunkbrain||[]).push([[2293],{1091:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"playbooks/kafka/scaling/adding-brokers","title":"Adding Kafka Brokers","description":"Adding brokers to a Kafka cluster is a horizontal scaling operation used to increase storage capacity and throughput.","source":"@site/docs/playbooks/kafka/scaling/adding-brokers.md","sourceDirName":"playbooks/kafka/scaling","slug":"/playbooks/kafka/scaling/adding-brokers","permalink":"/playbooks/kafka/scaling/adding-brokers","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"playbooks","previous":{"title":"Scaling Kafka Brokers","permalink":"/playbooks/kafka/scaling/"},"next":{"title":"Kafka Client Resilience Cheat-Sheet","permalink":"/playbooks/kafka/scaling/client-resilience"}}');var i=n(4848),t=n(8453);const o={},a="Adding Kafka Brokers",l={},c=[{value:"High-Level Process",id:"high-level-process",level:2},{value:"Detailed Steps",id:"detailed-steps",level:2},{value:"1. Provision &amp; Configure",id:"1-provision--configure",level:3},{value:"2. Start the Broker",id:"2-start-the-broker",level:3},{value:"3. Verify Membership",id:"3-verify-membership",level:3},{value:"4. Rebalance (Crucial Step)",id:"4-rebalance-crucial-step",level:3},{value:"Considerations",id:"considerations",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"adding-kafka-brokers",children:"Adding Kafka Brokers"})}),"\n",(0,i.jsx)(r.p,{children:"Adding brokers to a Kafka cluster is a horizontal scaling operation used to increase storage capacity and throughput."}),"\n",(0,i.jsx)(r.h2,{id:"high-level-process",children:"High-Level Process"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Provision Infrastructure"}),": Spin up the new server, container, or pod."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Configure Broker"}),": Update ",(0,i.jsx)(r.code,{children:"server.properties"})," with a unique ",(0,i.jsx)(r.code,{children:"broker.id"})," and connect it to the existing Zookeeper or KRaft quorum."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Start Broker"}),": Launch the Kafka process."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Verify Membership"}),": Ensure the broker has joined the cluster."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Rebalance Cluster"}),": Move partitions to the new broker to utilize its capacity."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"detailed-steps",children:"Detailed Steps"}),"\n",(0,i.jsx)(r.h3,{id:"1-provision--configure",children:"1. Provision & Configure"}),"\n",(0,i.jsx)(r.p,{children:"Ensure the new node has network connectivity to the existing brokers and Zookeeper/Controller nodes."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsxs)(r.strong,{children:["Key Configuration (",(0,i.jsx)(r.code,{children:"server.properties"}),"):"]})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-properties",children:"broker.id=4                  # Must be unique\nzookeeper.connect=zk1:2181,zk2:2181... # or controller.quorum.voters for KRaft\nlisteners=PLAINTEXT://:9092\nlog.dirs=/var/lib/kafka/data\n"})}),"\n",(0,i.jsx)(r.h3,{id:"2-start-the-broker",children:"2. Start the Broker"}),"\n",(0,i.jsx)(r.p,{children:"Start the Kafka service. The broker will register itself with the cluster controller."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# Example systemd start\nsudo systemctl start kafka\n"})}),"\n",(0,i.jsx)(r.h3,{id:"3-verify-membership",children:"3. Verify Membership"}),"\n",(0,i.jsx)(r.p,{children:"Check if the new broker is active."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Using Zookeeper (Legacy):"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"zookeeper-shell.sh localhost:2181 ls /brokers/ids\n# Output should include [..., 4]\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Using Admin Client:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"kafka-broker-api-versions.sh --bootstrap-server localhost:9092\n"})}),"\n",(0,i.jsx)(r.h3,{id:"4-rebalance-crucial-step",children:"4. Rebalance (Crucial Step)"}),"\n",(0,i.jsxs)(r.p,{children:["A new broker starts empty. It will ",(0,i.jsx)(r.strong,{children:"not"})," automatically receive existing data. You must explicitly move partitions to it."]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Option A: Kafka Reassign Partitions Tool (Manual)"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Generate a reassignment JSON file proposing moves to the new broker."}),"\n",(0,i.jsx)(r.li,{children:"Execute the reassignment."}),"\n",(0,i.jsx)(r.li,{children:"Verify completion."}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Option B: Cruise Control (Automated)"}),"\nIf using Cruise Control, simply trigger a ",(0,i.jsx)(r.code,{children:"add_broker"})," goal or let it auto-rebalance based on goals."]}),"\n",(0,i.jsx)(r.h2,{id:"considerations",children:"Considerations"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"I/O Impact"}),": Rebalancing triggers heavy network and disk I/O as data is copied. Throttle reassignment if necessary (",(0,i.jsx)(r.code,{children:"--throttle"}),")."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Client Updates"}),": Clients automatically discover the new broker via metadata updates, but they won't send produce requests to it until it becomes a leader for some partitions."]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(6540);const i={},t=s.createContext(i);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);